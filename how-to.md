# 如何使用Loo.py

## 安装 Loo.py 

为便于测试使用，安装基于 pyopencl 的 Loo.py。安装过程包括创建虚拟环境和安装相应的包两部分。采用Anaconda或者Miniconda完成安装较为简便：

```

```

为便于运行以及观察测试结果，建议在jyputer notebook中运行。

注意需要在jupyter notebook中配置虚拟环境：

```

```

## 基本操作

Loo.py的操作与OpenCL存在较多相似之处，因此本节会使用一些OpenCL中的概念进行介绍，以便于理解loo.py的操作实现。

### 声明

声明内核至少需要包含两部分：循环域和指令，分别为第一个和第二个参数

```python
knl = lp.make_kernel(
     "{ [i]: 0<=i<n }",
     "out[i] = a[i]*a[i]")
```

循环域指明了循环变量的取值范围，在此例中仅有`i`一个循环变量。事实上，loo.py的优化很大一部分基于对循环变量进行操作，因此循环变量可附加不同的标识以进行循环展开、依赖声明以及分解为子变量等操作。具体的用法将在[相关标识](#循环变量相关标识)部分介绍。

指令部分包含循环体内部执行的操作，一般为标量赋值的形式。其中指令之间的依赖是loo.py优化的重点。指令之间的依赖会降低循环并行度，但缺少依赖则会影响计算结果的正确性。

### 内核信息

通过打印内核可以查看其具体信息：

```

```

其中`Arguments`为参数，包括输入和输出的变量，以引用形式传递。注意此时的变量是`GlobalArg`，即OpenCL设备的全局变量，这将会在后续的性能优化中详细说明。`Domains`为循环域，当额外声明了标识时也会一并显示。`iname`即为循环变量，参见[循环变量相关标识](#循环变量相关标识)部分。`Instructions`包含声明的指令，每条指令均有`id`，用于计算依赖关系。

### 运行内核与代码生成




## 循环依赖

## 内核变换

## 循环变量相关标识

## 存储

## 同步

## 性能分析

## 相关链接

[GitHub repository](https://github.com/01-Loopy/loo.py-intro)

[项目简介、分工以及进展记录](https://github.com/01-Loopy/2017fall-student-teamworks/blob/master/01-loopy.md)